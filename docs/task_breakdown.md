# タスクブレイクダウン

**バージョン**: 1.0.0
**作成日**: 2025-01-15
**対象システム**: Zoom Phone フィードバックシステム 拡張版

---

## 目次

1. [タスク管理方法](#タスク管理方法)
2. [フェーズ1: 基盤構築](#フェーズ1-基盤構築)
3. [フェーズ2: プロンプト管理](#フェーズ2-プロンプト管理)
4. [フェーズ3: トークスクリプト管理](#フェーズ3-トークスクリプト管理)
5. [フェーズ4: 学習資料・RAG](#フェーズ4-学習資料rag)
6. [フェーズ5: KPI・ダッシュボード](#フェーズ5-kpiダッシュボード)
7. [フェーズ6: 音声感情分析](#フェーズ6-音声感情分析)
8. [フェーズ7: テスト・改善](#フェーズ7-テスト改善)

---

## タスク管理方法

### 優先度

- **P0**: クリティカル（システムの根幹）
- **P1**: 高優先度（主要機能）
- **P2**: 中優先度（補助機能）
- **P3**: 低優先度（Nice to have）

### 見積もり

- **S**: 1-2時間
- **M**: 半日-1日
- **L**: 2-3日
- **XL**: 4-5日
- **XXL**: 1週間以上

### タスク形式

```
[優先度] [見積もり] タスク名
  - 詳細手順1
  - 詳細手順2
  担当: <担当者>
  依存: <依存タスク>
```

---

## フェーズ1: 基盤構築

### M1.1: 開発環境構築

#### [P0][M] Next.js 14プロジェクト初期化

- [ ] `pnpm create next-app@latest` 実行
- [ ] TypeScript選択
- [ ] App Router選択
- [ ] Tailwind CSS選択
- [ ] ESLint設定
- [ ] Prettier設定
- [ ] `.gitignore` 調整
- 担当: フロントエンドリード
- 依存: なし

#### [P0][M] Supabaseプロジェクト作成

- [ ] https://supabase.com でプロジェクト作成
- [ ] Database Password設定
- [ ] Project URLとAPI Key取得
- [ ] `.env.local` に追加
- 担当: バックエンドリード
- 依存: なし

#### [P0][M] GCPプロジェクト作成

- [ ] GCPコンソールでプロジェクト作成
- [ ] 請求アカウント設定
- [ ] 必要なAPI有効化（Cloud Run, GCS, Pub/Sub）
- [ ] サービスアカウント作成
- [ ] 認証情報ダウンロード
- 担当: DevOpsエンジニア
- 依存: なし

#### [P0][S] GitHub Repositoryセットアップ

- [ ] リポジトリ作成
- [ ] README.md作成
- [ ] ブランチ保護設定（main）
- [ ] PRテンプレート作成
- [ ] Issue テンプレート作成
- 担当: プロジェクトマネージャー
- 依存: なし

#### [P1][M] CI/CD基本設定

- [ ] `.github/workflows/test.yml` 作成
- [ ] `.github/workflows/deploy.yml` 作成
- [ ] GitHub Secrets設定
- [ ] Vercel連携（フロントエンド）
- [ ] GCP連携（バックエンド）
- 担当: DevOpsエンジニア
- 依存: GitHub Repositoryセットアップ

---

### M1.2: データベース構築

#### [P0][L] Supabase拡張機能有効化

- [ ] SQL Editorで `CREATE EXTENSION IF NOT EXISTS "uuid-ossp";` 実行
- [ ] `CREATE EXTENSION IF NOT EXISTS "vector";` 実行
- [ ] `CREATE EXTENSION IF NOT EXISTS "pg_cron";` 実行
- [ ] 動作確認
- 担当: データベースエンジニア
- 依存: Supabaseプロジェクト作成

#### [P0][XL] 全11テーブル作成

- [ ] `users` テーブル作成
- [ ] `projects` テーブル作成
- [ ] `project_members` テーブル作成
- [ ] `prompts` テーブル作成
- [ ] `talk_scripts` テーブル作成
- [ ] `talk_script_hearing_items` テーブル作成
- [ ] `learning_materials` テーブル作成
- [ ] `learning_material_embeddings` テーブル作成
- [ ] `calls` テーブル作成
- [ ] `ng_reasons` テーブル作成
- [ ] `ng_reason_logs` テーブル作成
- 担当: データベースエンジニア
- 依存: Supabase拡張機能有効化

#### [P0][M] インデックス作成

- [ ] 各テーブルの基本インデックス作成
- [ ] 複合インデックス作成（`idx_calls_list_search` 等）
- [ ] pgvectorインデックス作成（ivfflat）
- [ ] インデックス効果確認（EXPLAIN ANALYZE）
- 担当: データベースエンジニア
- 依存: 全11テーブル作成

#### [P0][XL] RLSポリシー設定

- [ ] `users` テーブルRLS有効化・ポリシー作成
- [ ] `projects` テーブルRLS有効化・ポリシー作成
- [ ] `calls` テーブルRLS有効化・ポリシー作成
- [ ] 全テーブルRLS設定
- [ ] RLSテスト（各ロールでアクセス確認）
- 担当: データベースエンジニア
- 依存: 全11テーブル作成

#### [P1][M] トリガー実装

- [ ] `update_updated_at_column()` 関数作成
- [ ] 各テーブルにトリガー設定
- [ ] `deactivate_old_versions()` 関数作成（プロンプト/トークスクリプト用）
- [ ] トリガー動作確認
- 担当: データベースエンジニア
- 依存: 全11テーブル作成

#### [P1][M] マイグレーションスクリプト作成

- [ ] `supabase/migrations/` ディレクトリ作成
- [ ] 各テーブル作成SQLをファイル分割
- [ ] マイグレーション順序管理
- [ ] ロールバックスクリプト作成
- [ ] マイグレーション実行テスト
- 担当: データベースエンジニア
- 依存: 全11テーブル作成

---

### M1.3: 認証機能実装

#### [P0][M] Supabase Auth設定

- [ ] Supabaseダッシュボードで認証設定
- [ ] Google OAuth設定（Client ID, Secret取得）
- [ ] Email/Passwordログイン有効化
- [ ] メール送信設定（認証メール）
- [ ] リダイレクトURL設定
- 担当: バックエンドリード
- 依存: Supabaseプロジェクト作成

#### [P0][L] ログインページ実装

- [ ] `/app/login/page.tsx` 作成
- [ ] Googleログインボタン実装
- [ ] Email/Passwordフォーム実装
- [ ] エラーハンドリング
- [ ] ローディング状態
- [ ] ログイン後リダイレクト
- 担当: フロントエンドエンジニア
- 依存: Supabase Auth設定

#### [P0][M] Next.js Middlewareで認証チェック

- [ ] `middleware.ts` 作成
- [ ] Supabase Auth Helpersインストール
- [ ] 認証チェックロジック実装
- [ ] ログインページへのリダイレクト
- [ ] 公開ページの除外設定
- 担当: フロントエンドリード
- 依存: Supabase Auth設定

#### [P0][M] ユーザー情報取得API実装

- [ ] `/app/api/auth/user/route.ts` 作成
- [ ] Supabaseからユーザー情報取得
- [ ] プロジェクト一覧取得（所属プロジェクト）
- [ ] レスポンス形式設計
- [ ] エラーハンドリング
- 担当: バックエンドエンジニア
- 依存: Supabase Auth設定

#### [P1][M] ログアウト機能実装

- [ ] `/app/api/auth/logout/route.ts` 作成
- [ ] Supabase signOut呼び出し
- [ ] クライアントサイドログアウト処理
- [ ] ログインページへのリダイレクト
- 担当: フロントエンドエンジニア
- 依存: ログインページ実装

---

### M1.4: GCS・Cloud Run構築

#### [P0][M] GCSバケット作成

- [ ] `gsutil mb -l asia-northeast1 gs://zoom-phone-feedback-prod` 実行
- [ ] バケット権限設定
- [ ] CORS設定
- [ ] 署名URL設定確認
- 担当: DevOpsエンジニア
- 依存: GCPプロジェクト作成

#### [P0][M] Lifecycle設定（6ヶ月自動削除）

- [ ] `lifecycle.json` 作成
- [ ] 6ヶ月後削除ルール設定（calls/プレフィックス）
- [ ] `gsutil lifecycle set lifecycle.json gs://bucket-name` 実行
- [ ] 設定確認
- 担当: DevOpsエンジニア
- 依存: GCSバケット作成

#### [P0][XL] Cloud Run: Zoom Proxy Service デプロイ

- [ ] `backend/zoom-proxy/` ディレクトリ作成
- [ ] `package.json` 作成
- [ ] Express.js初期設定
- [ ] Webhook受信エンドポイント実装（`POST /webhook/zoom`）
- [ ] Zoom署名検証実装
- [ ] `Dockerfile` 作成
- [ ] Cloud Runデプロイコマンド作成
- [ ] デプロイ実行
- 担当: バックエンドリード
- 依存: GCPプロジェクト作成

#### [P0][XL] Cloud Run: Backend Processor Service デプロイ

- [ ] `backend/processor/` ディレクトリ作成
- [ ] `package.json` 作成
- [ ] Express.js初期設定
- [ ] 処理エントリーポイント実装
- [ ] `Dockerfile` 作成
- [ ] Cloud Runデプロイコマンド作成
- [ ] デプロイ実行
- 担当: バックエンドリード
- 依存: GCPプロジェクト作成

#### [P0][M] Cloud Pub/Sub設定

- [ ] トピック作成（`zoom-webhook-topic`）
- [ ] サブスクリプション作成
- [ ] Zoom Proxy → Pub/Sub連携実装
- [ ] Backend Processor → Pub/Sub連携実装
- [ ] 動作確認
- 担当: DevOpsエンジニア
- 依存: Cloud Run両サービスデプロイ

#### [P0][M] 環境変数管理（Secret Manager）

- [ ] OpenAI API Key登録
- [ ] Supabase Service Role Key登録
- [ ] その他シークレット登録
- [ ] Cloud Runへのシークレット注入設定
- [ ] 動作確認
- 担当: DevOpsエンジニア
- 依存: Cloud Runデプロイ

---

### M1.5: 基本的な通話処理フロー

#### [P0][L] Zoom Webhook受信実装

- [ ] `POST /webhook/zoom` エンドポイント完成
- [ ] リクエストボディパース
- [ ] イベントタイプ判定（`recording.completed`）
- [ ] Pub/Subメッセージ発行
- [ ] 200 OK即座に返却
- [ ] エラーハンドリング
- 担当: バックエンドエンジニア
- 依存: Cloud Run: Zoom Proxy Service デプロイ

#### [P0][L] 音声ダウンロード実装

- [ ] Zoom API認証実装
- [ ] 録音ファイルダウンロードURL取得
- [ ] 音声ファイルダウンロード
- [ ] ストリーム処理（大容量対応）
- [ ] エラーハンドリング（リトライロジック）
- 担当: バックエンドエンジニア
- 依存: Backend Processor Service デプロイ

#### [P0][M] GCS保存実装

- [ ] Google Cloud Storage SDK導入
- [ ] ファイルアップロード実装
- [ ] パス命名規則（`calls/{call_id}/audio.mp3`）
- [ ] 公開URLまたは署名URL取得
- [ ] エラーハンドリング
- 担当: バックエンドエンジニア
- 依存: GCSバケット作成、音声ダウンロード実装

#### [P0][L] Whisper API連携（文字起こし）

- [ ] OpenAI SDK導入
- [ ] Whisper API呼び出し実装
- [ ] SRT形式またはJSON形式取得
- [ ] GCS保存（`calls/{call_id}/transcript.srt`）
- [ ] エラーハンドリング（リトライロジック）
- [ ] レート制限対応
- 担当: バックエンドエンジニア
- 依存: 音声ダウンロード実装

#### [P0][L] GPT-5-mini連携（通話状態判定）

- [ ] OpenAI SDK導入（GPT-5-mini）
- [ ] プロンプト設計（connected/reception/no_conversation判定）
- [ ] **重要**: Temperature パラメータを使用しない
- [ ] API呼び出し実装
- [ ] レスポンスパース
- [ ] エラーハンドリング
- 担当: バックエンドエンジニア
- 依存: Whisper API連携

#### [P0][M] Supabaseへのメタデータ保存

- [ ] Supabase Client初期化
- [ ] `calls` テーブルへのINSERT実装
- [ ] 通話状態、音声URL、文字起こしURL保存
- [ ] エラーハンドリング
- [ ] トランザクション管理
- 担当: バックエンドエンジニア
- 依存: 全11テーブル作成、GCS保存実装

#### [P1][M] Slack通知実装（基本版）

- [ ] Slack Webhook URL取得（プロジェクトごと）
- [ ] 通知メッセージフォーマット設計
- [ ] Slack API呼び出し実装
- [ ] エラーハンドリング
- [ ] 通知条件分岐（connected/reception/no_conversation）
- 担当: バックエンドエンジニア
- 依存: Supabaseへのメタデータ保存

---

### M1.6: プロジェクト・ユーザー管理

#### [P0][L] プロジェクト一覧ページ

- [ ] `/app/projects/page.tsx` 作成
- [ ] プロジェクト一覧取得API呼び出し
- [ ] テーブル表示（shadcn/ui Table）
- [ ] ページネーション実装
- [ ] ローディング状態
- 担当: フロントエンドエンジニア
- 依存: 認証機能実装

#### [P0][M] プロジェクト作成・編集・削除API

- [ ] `POST /api/projects` 実装
- [ ] `PUT /api/projects/:id` 実装
- [ ] `DELETE /api/projects/:id` 実装
- [ ] バリデーション（Zod）
- [ ] RLS確認（オーナーのみ）
- 担当: バックエンドエンジニア
- 依存: 全11テーブル作成

#### [P0][M] プロジェクト作成・編集・削除UI

- [ ] プロジェクト作成フォーム（shadcn/ui Dialog）
- [ ] プロジェクト編集フォーム
- [ ] 削除確認ダイアログ
- [ ] バリデーション（React Hook Form + Zod）
- [ ] エラーハンドリング
- 担当: フロントエンドエンジニア
- 依存: プロジェクト作成・編集・削除API

#### [P1][L] メンバー管理UI

- [ ] `/app/projects/[id]/members/page.tsx` 作成
- [ ] メンバー一覧取得API呼び出し
- [ ] メンバー追加フォーム
- [ ] メンバー削除機能
- [ ] ロール変更機能（オーナー/ディレクター/ユーザー）
- 担当: フロントエンドエンジニア
- 依存: プロジェクト一覧ページ

#### [P1][M] メンバー管理API

- [ ] `GET /api/projects/:id/members` 実装
- [ ] `POST /api/projects/:id/members` 実装
- [ ] `DELETE /api/projects/:id/members/:userId` 実装
- [ ] RLS確認（オーナー/ディレクター権限）
- 担当: バックエンドエンジニア
- 依存: 全11テーブル作成

---

## フェーズ2: プロンプト管理

### M2.1: プロンプト管理UI

#### [P0][L] プロンプト一覧・詳細ページ

- [ ] `/app/projects/[id]/prompts/page.tsx` 作成
- [ ] プロンプトタイプ切り替え（connected/reception）
- [ ] 現在のプロンプト表示
- [ ] マークダウンプレビュー
- [ ] 文字数カウンター表示
- 担当: フロントエンドエンジニア
- 依存: プロジェクト一覧ページ

#### [P0][M] プロンプト取得API

- [ ] `GET /api/prompts` 実装
- [ ] クエリパラメータ（project_id, type）
- [ ] プロジェクト固有プロンプト優先取得
- [ ] デフォルトプロンプトフォールバック
- [ ] RLS確認
- 担当: バックエンドエンジニア
- 依存: 全11テーブル作成

#### [P0][L] プロンプト作成・編集フォーム

- [ ] マークダウンエディタ統合（`@uiw/react-md-editor` 等）
- [ ] リアルタイムプレビュー
- [ ] 変更コメント入力フィールド
- [ ] 保存ボタン
- [ ] バリデーション
- 担当: フロントエンドエンジニア
- 依存: プロンプト一覧・詳細ページ

#### [P0][M] プロンプト作成・更新API

- [ ] `POST /api/prompts` 実装
- [ ] `PUT /api/prompts/:id` 実装
- [ ] バージョン自動インクリメント
- [ ] `is_active` フラグ管理（トリガー経由）
- [ ] RLS確認（オーナー/ディレクター権限）
- 担当: バックエンドエンジニア
- 依存: プロンプト取得API

---

### M2.2: プロンプトバージョン管理

#### [P1][M] 変更履歴表示UI

- [ ] 履歴一覧取得API呼び出し
- [ ] タイムライン形式表示
- [ ] バージョン番号、変更者、変更日時表示
- [ ] 変更コメント表示
- [ ] diff表示（オプション）
- 担当: フロントエンドエンジニア
- 依存: プロンプト一覧・詳細ページ

#### [P1][M] 変更履歴取得API

- [ ] `GET /api/prompts/:id/history` 実装
- [ ] 過去10件取得
- [ ] 作成者情報JOIN
- [ ] 日時降順ソート
- 担当: バックエンドエンジニア
- 依存: プロンプト作成・更新API

#### [P2][M] バージョン復元機能

- [ ] 復元ボタン追加
- [ ] 確認ダイアログ
- [ ] 復元API呼び出し
- [ ] 新バージョンとして保存
- 担当: フロントエンドエンジニア
- 依存: 変更履歴表示UI

---

### M2.3: AIプロンプトアシスタント

#### [P1][L] 音声録音UI

- [ ] 録音ボタン実装
- [ ] Web Audio API統合
- [ ] リアルタイム録音時間表示
- [ ] 停止ボタン
- [ ] 録音データ保存（Base64）
- [ ] 最大5分制限
- 担当: フロントエンドエンジニア
- 依存: プロンプト作成・編集フォーム

#### [P1][M] Whisper API連携（音声→文字起こし）

- [ ] 録音データをバックエンドに送信
- [ ] Whisper API呼び出し
- [ ] 文字起こし結果返却
- [ ] エラーハンドリング
- 担当: バックエンドエンジニア
- 依存: Backend Processor Service

#### [P1][M] GPT-5連携（文字起こし→プロンプト生成）

- [ ] GPT-5プロンプト設計（プロンプト生成用）
- [ ] **重要**: Temperature パラメータを使用しない
- [ ] API呼び出し実装
- [ ] 生成されたプロンプト返却
- [ ] エラーハンドリング
- 担当: バックエンドエンジニア
- 依存: Whisper API連携

#### [P1][M] プロンプト生成API実装

- [ ] `POST /api/prompts/generate` 実装
- [ ] 音声受信（Base64）
- [ ] Whisper API → GPT-5 連携
- [ ] レスポンス形式設計
- 担当: バックエンドエンジニア
- 依存: GPT-5連携

#### [P1][M] 生成プロンプト表示・編集UI

- [ ] 文字起こしテキスト表示
- [ ] 文字起こし編集機能
- [ ] 「プロンプト生成」ボタン
- [ ] 生成されたプロンプト表示
- [ ] プロンプト編集機能
- [ ] 保存
- 担当: フロントエンドエンジニア
- 依存: プロンプト生成API実装

---

### M2.4: フィードバック生成実装

#### [P0][XL] フィードバック生成ロジック実装

- [ ] プロンプト取得ロジック（プロジェクト固有 or デフォルト）
- [ ] GPT-5-mini呼び出し実装
- [ ] **重要**: Temperature パラメータを使用しない
- [ ] フィードバック生成条件判定（connected かつ 通話時間 >= 60秒）
- [ ] `calls` テーブルに `feedback_text` 保存
- [ ] `prompt_version_id` 保存
- 担当: バックエンドエンジニア
- 依存: 基本的な通話処理フロー、プロンプト取得API

#### [P0][M] Slack通知にフィードバック追加

- [ ] フィードバック生成時の通知フォーマット更新
- [ ] アポイント判定表示（AI判定）
- [ ] Webアプリリンク追加
- [ ] 通知条件分岐（connected ≧ 60秒 / < 60秒 / reception / no_conversation）
- 担当: バックエンドエンジニア
- 依存: フィードバック生成ロジック実装

#### [P0][M] 通話詳細ページ実装

- [ ] `/app/calls/[id]/page.tsx` 作成
- [ ] 通話詳細取得API呼び出し
- [ ] 基本情報表示（日時、電話番号、通話時間等）
- [ ] フィードバック表示
- [ ] 文字起こしテキスト表示
- [ ] 音声ファイル再生プレーヤー
- 担当: フロントエンドエンジニア
- 依存: フィードバック生成ロジック実装

#### [P0][M] 通話詳細取得API

- [ ] `GET /api/calls/:id` 実装
- [ ] `calls` テーブルから取得
- [ ] プロンプトバージョン情報JOIN
- [ ] 音声ファイル署名URL生成
- [ ] RLS確認
- 担当: バックエンドエンジニア
- 依存: フィードバック生成ロジック実装

---

## フェーズ3: トークスクリプト管理

### M3.1: トークスクリプト管理UI

#### [P0][XL] トークスクリプト作成・編集ページ

- [ ] `/app/projects/[id]/talk-scripts/page.tsx` 作成
- [ ] フェーズ別入力フォーム（オープニング/ヒアリング/提案/クロージング）
- [ ] マークダウンエディタ統合
- [ ] リアルタイムプレビュー
- [ ] 変更コメント入力
- [ ] 保存ボタン
- 担当: フロントエンドリード
- 依存: プロジェクト一覧ページ

#### [P0][L] ヒアリング項目管理UI

- [ ] ヒアリング項目一覧表示
- [ ] 項目追加フォーム
- [ ] 項目編集フォーム
- [ ] 項目削除ボタン（デフォルト項目は削除不可）
- [ ] ドラッグ&ドロップで表示順序変更
- [ ] 最大10項目制限
- 担当: フロントエンドエンジニア
- 依存: トークスクリプト作成・編集ページ

#### [P0][M] トークスクリプト取得API

- [ ] `GET /api/talk-scripts` 実装
- [ ] プロジェクトIDでフィルタ
- [ ] 最新バージョン（`is_active=TRUE`）取得
- [ ] ヒアリング項目JOIN
- [ ] RLS確認
- 担当: バックエンドエンジニア
- 依存: 全11テーブル作成

#### [P0][M] トークスクリプト作成・更新API

- [ ] `POST /api/talk-scripts` 実装
- [ ] `PUT /api/talk-scripts/:id` 実装
- [ ] バージョン自動インクリメント
- [ ] `is_active` フラグ管理
- [ ] ヒアリング項目同時保存
- [ ] RLS確認（オーナー/ディレクター権限）
- 担当: バックエンドエンジニア
- 依存: トークスクリプト取得API

#### [P1][M] ヒアリング項目API

- [ ] `POST /api/talk-scripts/:id/hearing-items` 実装
- [ ] `PUT /api/talk-scripts/hearing-items/:itemId` 実装
- [ ] `DELETE /api/talk-scripts/hearing-items/:itemId` 実装
- [ ] デフォルト項目削除防止
- [ ] 表示順序管理
- 担当: バックエンドエンジニア
- 依存: トークスクリプト作成・更新API

---

### M3.2: PDF取り込み機能

#### [P1][L] PDFアップロードUI

- [ ] PDFアップロードフォーム
- [ ] ファイルサイズ検証（最大10MB）
- [ ] ファイルタイプ検証（PDF）
- [ ] アップロード中プログレスバー
- [ ] 抽出結果プレビュー
- 担当: フロントエンドエンジニア
- 依存: トークスクリプト作成・編集ページ

#### [P1][XL] GPT-5 Vision API連携（PDF→テキスト抽出）

- [ ] PDFファイル受信
- [ ] GPT-5 Vision API呼び出し
- [ ] テキスト抽出
- [ ] フェーズ自動判定プロンプト設計
- [ ] **重要**: Temperature パラメータを使用しない
- [ ] レスポンス形式設計（JSON）
- 担当: バックエンドリード
- 依存: Backend Processor Service

#### [P1][M] フェーズ自動判定ロジック

- [ ] GPT-5によるテキスト分類
- [ ] オープニング判定
- [ ] ヒアリング判定（項目抽出含む）
- [ ] 提案判定
- [ ] クロージング判定
- [ ] エラーハンドリング
- 担当: バックエンドエンジニア
- 依存: GPT-5 Vision API連携

#### [P1][M] PDF取り込みAPI実装

- [ ] `POST /api/talk-scripts/import-pdf` 実装
- [ ] PDFファイル受信（Base64）
- [ ] GPT-5 Vision API連携
- [ ] フェーズ判定結果返却
- [ ] エラーハンドリング
- 担当: バックエンドエンジニア
- 依存: フェーズ自動判定ロジック

#### [P2][M] OCRフォールバック実装

- [ ] Tesseract.js導入
- [ ] GPT-5 Vision API失敗時のフォールバック
- [ ] テキスト抽出
- [ ] フェーズ自動判定適用
- 担当: バックエンドエンジニア
- 依存: PDF取り込みAPI実装

---

### M3.3: トークスクリプト一致率分析

#### [P0][XXL] GPT-5連携（セマンティック一致率評価）

- [ ] トークスクリプト一致率分析プロンプト設計
- [ ] GPT-5呼び出し実装
- [ ] **重要**: Temperature パラメータを使用しない
- [ ] フェーズ別一致率計算
- [ ] ヒアリング項目カバー率計算
- [ ] JSONB形式レスポンスパース
- [ ] エラーハンドリング
- 担当: バックエンドリード
- 依存: Backend Processor Service、トークスクリプト取得API

#### [P0][M] 一致率計算ロジック実装

- [ ] 総合一致率計算（4フェーズ平均）
- [ ] ヒアリング項目カバー率計算
- [ ] 評価コメント生成
- [ ] JSONBデータ構造設計
- 担当: バックエンドエンジニア
- 依存: GPT-5連携

#### [P0][M] 分析結果保存

- [ ] `calls` テーブルに保存
- [ ] `talk_script_version_id` 保存
- [ ] `overall_match_rate` 保存
- [ ] `phase_match_rates` JSONB保存
- [ ] `hearing_item_coverage` JSONB保存
- 担当: バックエンドエンジニア
- 依存: 一致率計算ロジック実装

#### [P0][L] 通話詳細ページに一致率表示

- [ ] トークスクリプト分析セクション追加
- [ ] 総合一致率表示
- [ ] フェーズ別一致率表示（プログレスバー）
- [ ] ヒアリング項目カバー状況表示（チェックリスト）
- [ ] 詳細展開可能UI（アコーディオン）
- 担当: フロントエンドエンジニア
- 依存: 分析結果保存

---

### M3.4: 因果関係を考慮したフィードバック統合

#### [P0][XL] 因果関係判定ロジック実装

- [ ] パターンA判定（ヒアリング不足）
- [ ] パターンB判定（提案力不足）
- [ ] パターンC判定（クロージング不足）
- [ ] パターンD判定（その他）
- [ ] 判定結果に基づくフィードバック重点決定
- 担当: バックエンドリード
- 依存: 一致率計算ロジック実装

#### [P0][L] 統合フィードバック生成プロンプト設計

- [ ] 4要素統合プロンプト設計
  - トークスクリプト一致率
  - RAG検索結果（未実装段階では空）
  - NG理由トレンド（未実装段階では空）
  - 文字起こしテキスト
- [ ] 因果関係ロジックをシステムプロンプトに組み込み
- [ ] GPT-5またはGPT-5-mini選択ロジック
- [ ] **重要**: Temperature パラメータを使用しない
- 担当: バックエンドリード
- 依存: 因果関係判定ロジック実装

#### [P0][M] フィードバック生成ロジック更新

- [ ] トークスクリプト分析結果取得
- [ ] 因果関係判定実行
- [ ] 統合プロンプトに分析結果埋め込み
- [ ] GPT-5またはGPT-5-mini呼び出し
- [ ] フィードバック生成
- 担当: バックエンドエンジニア
- 依存: 統合フィードバック生成プロンプト設計

---

## フェーズ4: 学習資料・RAG

### M4.1: 学習資料管理UI

#### [P0][L] 学習資料一覧ページ

- [ ] `/app/projects/[id]/learning-materials/page.tsx` 作成
- [ ] 詳細資料一覧表示（最大2個）
- [ ] 事例集一覧表示（最大5個）
- [ ] アップロード数制限表示
- [ ] ファイルサイズ表示
- [ ] 削除ボタン
- 担当: フロントエンドエンジニア
- 依存: プロジェクト一覧ページ

#### [P0][M] アップロードUI

- [ ] ファイルアップロードフォーム
- [ ] 資料タイプ選択（detail/case_study）
- [ ] ファイルタイプ検証（PDF/CSV）
- [ ] ファイルサイズ検証（最大10MB）
- [ ] アップロード数制限チェック
- [ ] アップロード中プログレスバー
- 担当: フロントエンドエンジニア
- 依存: 学習資料一覧ページ

#### [P0][M] 学習資料取得API

- [ ] `GET /api/learning-materials` 実装
- [ ] プロジェクトIDでフィルタ
- [ ] 資料タイプでフィルタ（オプション）
- [ ] ファイル数カウント
- [ ] RLS確認
- 担当: バックエンドエンジニア
- 依存: 全11テーブル作成

#### [P0][M] 学習資料アップロードAPI

- [ ] `POST /api/learning-materials` 実装
- [ ] ファイル受信（Base64）
- [ ] GCSアップロード
- [ ] `learning_materials` テーブル保存
- [ ] アップロード数制限チェック（詳細資料2個、事例集5個）
- [ ] RLS確認（オーナー/ディレクター権限）
- 担当: バックエンドエンジニア
- 依存: 学習資料取得API

#### [P0][M] 学習資料削除API

- [ ] `DELETE /api/learning-materials/:id` 実装
- [ ] GCSファイル削除
- [ ] `learning_materials` テーブル削除（CASCADE）
- [ ] `learning_material_embeddings` 自動削除確認
- [ ] RLS確認
- 担当: バックエンドエンジニア
- 依存: 学習資料アップロードAPI

#### [P1][M] プレビュー機能

- [ ] `GET /api/learning-materials/:id/preview` 実装
- [ ] PDF: GCS署名URL返却（iframe表示）
- [ ] CSV: パース処理 → テーブル形式JSON返却
- [ ] プレビューUI実装
- 担当: フロントエンド・バックエンドエンジニア
- 依存: 学習資料取得API

---

### M4.2: Embedding処理実装

#### [P0][M] PDFパース処理

- [ ] pdf-parse導入
- [ ] PDFテキスト抽出
- [ ] ページ分割
- [ ] メタデータ抽出
- 担当: バックエンドエンジニア
- 依存: Backend Processor Service

#### [P0][M] CSVパース処理

- [ ] csv-parse導入
- [ ] CSV読み込み
- [ ] 列定義（企業名、業種、課題、解決内容等）
- [ ] 行ごとにテキスト結合
- 担当: バックエンドエンジニア
- 依存: Backend Processor Service

#### [P0][M] テキストチャンキング

- [ ] 500文字程度でテキスト分割
- [ ] オーバーラップ設定（50文字）
- [ ] チャンク境界調整（文末で分割）
- 担当: バックエンドエンジニア
- 依存: PDFパース処理、CSVパース処理

#### [P0][L] OpenAI Embedding API連携

- [ ] OpenAI Embedding API呼び出し（`text-embedding-3-small`）
- [ ] バッチ処理（複数チャンクを一度に処理）
- [ ] ベクトル取得
- [ ] エラーハンドリング（リトライロジック）
- [ ] レート制限対応
- 担当: バックエンドエンジニア
- 依存: テキストチャンキング

#### [P0][M] Embedding保存

- [ ] `learning_material_embeddings` テーブル保存
- [ ] `material_id` 関連付け
- [ ] `chunk_text` 保存
- [ ] `embedding` VECTOR保存
- [ ] バッチINSERT
- 担当: バックエンドエンジニア
- 依存: OpenAI Embedding API連携

#### [P1][M] バッチ処理最適化

- [ ] 大量データ対応
- [ ] 並列処理
- [ ] 進捗表示
- [ ] エラーリカバリー
- 担当: バックエンドエンジニア
- 依存: Embedding保存

---

### M4.3: pgvector設定・RAG検索実装

#### [P0][S] pgvector拡張機能確認

- [ ] `CREATE EXTENSION IF NOT EXISTS "vector";` 確認
- [ ] ベクトル検索インデックス作成確認
- 担当: データベースエンジニア
- 依存: 全11テーブル作成

#### [P0][M] RAG検索関数実装

- [ ] クエリテキストのEmbedding生成
- [ ] pgvectorコサイン類似度検索
- [ ] 上位5件取得
- [ ] プロジェクトIDでフィルタ
- [ ] チャンクテキスト返却
- 担当: バックエンドエンジニア
- 依存: pgvector拡張機能確認、Embedding保存

#### [P0][M] 検索パフォーマンスチューニング

- [ ] インデックス最適化（ivfflat listsパラメータ調整）
- [ ] EXPLAINクエリ分析
- [ ] キャッシュ戦略検討
- 担当: データベースエンジニア
- 依存: RAG検索関数実装

---

### M4.4: RAG統合フィードバック生成

#### [P0][M] RAG検索結果取得

- [ ] 通話処理時にRAG検索実行
- [ ] 検索結果（上位5件）取得
- [ ] 検索結果が0件の場合の処理
- 担当: バックエンドエンジニア
- 依存: RAG検索関数実装

#### [P0][L] GPT-5プロンプトに検索結果埋め込み

- [ ] RAG検索結果をプロンプトに追加
- [ ] 事例集の業種別・課題別情報強調
- [ ] プロンプト長制限対応
- [ ] RAGあり: GPT-5、RAGなし: GPT-5-mini 切り替え
- [ ] **重要**: Temperature パラメータを使用しない
- 担当: バックエンドリード
- 依存: RAG検索結果取得

#### [P0][M] フィードバック生成ロジック更新

- [ ] RAG検索結果統合
- [ ] 統合プロンプト更新
- [ ] GPT-5またはGPT-5-mini呼び出し
- [ ] フィードバック生成
- 担当: バックエンドエンジニア
- 依存: GPT-5プロンプトに検索結果埋め込み

#### [P1][M] フィードバック品質確認

- [ ] 実際の通話データでテスト
- [ ] RAG検索結果の関連性確認
- [ ] フィードバック内容の改善確認
- [ ] プロンプト調整
- 担当: プロジェクトマネージャー、バックエンドリード
- 依存: フィードバック生成ロジック更新

---

## フェーズ5: KPI・ダッシュボード

### M5.1: KPI集計API実装

#### [P0][L] KPI集計クエリ実装

- [ ] 架電数集計
- [ ] 接続数集計（status='connected'）
- [ ] 受付止まり数集計（status='reception'）
- [ ] 会話なし数集計（status='no_conversation'）
- [ ] 接続率計算（接続数 / 架電数 × 100）
- [ ] アポイント数集計（appointment_confirmed=TRUE）
- [ ] 有効リード数集計（valid_lead_confirmed=TRUE）
- 担当: バックエンドエンジニア
- 依存: 全11テーブル作成

#### [P0][M] 期間別集計実装

- [ ] 日次集計
- [ ] 週次集計
- [ ] 月次集計
- [ ] カスタム期間集計（date_from, date_to）
- 担当: バックエンドエンジニア
- 依存: KPI集計クエリ実装

#### [P0][M] プロジェクト別・ユーザー別集計

- [ ] プロジェクトIDでフィルタ
- [ ] ユーザーIDでフィルタ
- [ ] 集計結果グルーピング
- 担当: バックエンドエンジニア
- 依存: KPI集計クエリ実装

#### [P0][M] KPI API実装

- [ ] `GET /api/kpi` 実装
- [ ] クエリパラメータ（project_id, user_id, period, date_from, date_to）
- [ ] レスポンス形式設計
- [ ] RLS確認
- 担当: バックエンドエンジニア
- 依存: 期間別集計実装、プロジェクト別・ユーザー別集計

---

### M5.2: ダッシュボードUI実装

#### [P0][L] ダッシュボードページ作成

- [ ] `/app/dashboard/page.tsx` 作成
- [ ] レイアウト設計
- [ ] 期間選択UI（日次/週次/月次/カスタム）
- [ ] プロジェクト選択UI
- [ ] ユーザー選択UI（オプション）
- 担当: フロントエンドリード
- 依存: 認証機能実装

#### [P0][M] KPIカード表示

- [ ] KPI API呼び出し
- [ ] 架電数カード
- [ ] 接続数カード
- [ ] 接続率カード
- [ ] アポイント数カード
- [ ] shadcn/ui Card使用
- 担当: フロントエンドエンジニア
- 依存: ダッシュボードページ作成、KPI API実装

#### [P0][L] グラフ表示実装

- [ ] Recharts導入
- [ ] 折れ線グラフ（接続率推移）
- [ ] 棒グラフ（ユーザー別架電数）
- [ ] 円グラフ（通話状態比率）
- [ ] レスポンシブデザイン
- 担当: フロントエンドエンジニア
- 依存: KPIカード表示

---

### M5.3: NG理由分析機能

#### [P0][L] GPT-5-mini連携（NG理由判定）

- [ ] NG理由判定プロンプト設計
- [ ] GPT-5-mini呼び出し
- [ ] **重要**: Temperature パラメータを使用しない
- [ ] 既存分類への自動分類
- [ ] 「その他」へのフォールバック
- [ ] 判定根拠テキスト抽出
- 担当: バックエンドエンジニア
- 依存: Backend Processor Service

#### [P0][M] NG理由ログ保存

- [ ] `ng_reason_logs` テーブル保存
- [ ] `call_id` 関連付け（ON DELETE SET NULL）
- [ ] `ng_reason_id` 保存
- [ ] `call_date` 保存（通話削除後も参照可能）
- [ ] `ai_confidence` 保存
- [ ] `evidence_text` 保存
- 担当: バックエンドエンジニア
- 依存: GPT-5-mini連携

#### [P0][M] NG理由集計API

- [ ] `GET /api/kpi/ng-reasons` 実装
- [ ] プロジェクトIDでフィルタ
- [ ] 期間指定（date_from, date_to）
- [ ] NG理由別集計
- [ ] 比率計算
- [ ] 前月比トレンド計算
- 担当: バックエンドエンジニア
- 依存: NG理由ログ保存

#### [P0][M] NG理由グラフ表示

- [ ] 円グラフ（NG理由比率）
- [ ] 棒グラフ（NG理由別件数）
- [ ] 時系列グラフ（トレンド）
- [ ] ダッシュボードに統合
- 担当: フロントエンドエンジニア
- 依存: NG理由集計API

#### [P1][M] NG理由マスタ管理UI

- [ ] NG理由一覧表示
- [ ] NG理由追加フォーム（オーナーのみ）
- [ ] NG理由編集フォーム
- [ ] NG理由削除（使用中は削除不可）
- 担当: フロントエンドエンジニア
- 依存: ダッシュボードページ作成

#### [P0][M] NG理由トレンドをフィードバックに統合

- [ ] 過去1ヶ月のNG理由集計
- [ ] 統合フィードバック生成プロンプトに追加
- [ ] トレンド情報を考慮したフィードバック生成
- 担当: バックエンドエンジニア
- 依存: NG理由集計API

---

### M5.4: リアルタイム更新実装

#### [P1][M] Supabase Realtime Subscription設定

- [ ] Supabase RealtimeチャネルSubscribe
- [ ] `calls` テーブルのINSERTイベント監視
- [ ] 新しい通話データ受信
- 担当: フロントエンドエンジニア
- 依存: ダッシュボードページ作成

#### [P1][M] ダッシュボード自動更新

- [ ] Realtime イベント受信時にKPI再取得
- [ ] グラフ自動更新
- [ ] トースト通知表示
- 担当: フロントエンドエンジニア
- 依存: Supabase Realtime Subscription設定

---

## フェーズ6: 音声感情分析

### M6.1: 既存API調査

#### [P1][M] API調査・比較

- [ ] Google Cloud Speech-to-Text 感情分析調査
- [ ] Azure Emotion API調査
- [ ] AWS Transcribe 感情分析調査
- [ ] 各APIのコスト比較
- [ ] 各APIの精度比較（サンプルテスト）
- [ ] API選定レポート作成
- 担当: バックエンドリード、プロジェクトマネージャー
- 依存: なし

---

### M6.2: 音声感情分析実装（既存API採用の場合）

#### [P1][L] 選定API連携実装

- [ ] 選定APIのSDK導入
- [ ] 音声ファイルアップロード
- [ ] 感情スコア取得
- [ ] 営業担当者/顧客の分離ロジック
- [ ] JSONデータ生成
- [ ] GCS保存（`calls/{call_id}/emotion_analysis.json`）
- 担当: バックエンドエンジニア
- 依存: API調査・比較

---

### M6.3: 感情分析グラフUI

#### [P1][L] グラフコンポーネント作成

- [ ] 時間軸表示
- [ ] 周波数軸表示
- [ ] カラーマップ（緑/黄/赤）
- [ ] 営業担当者/顧客の波形分離（正/負の領域）
- [ ] グラフ上クリックでタイムスタンプ取得
- 担当: フロントエンドエンジニア
- 依存: 音声感情分析実装

#### [P1][M] 音声再生連動

- [ ] グラフクリック時に音声再生位置変更
- [ ] 文字起こしハイライト連動
- [ ] 現在再生位置をグラフに表示
- 担当: フロントエンドエンジニア
- 依存: グラフコンポーネント作成

#### [P1][M] 通話詳細ページ統合

- [ ] 感情分析グラフセクション追加
- [ ] グラフ表示
- [ ] 音声プレーヤーとの連動確認
- 担当: フロントエンドエンジニア
- 依存: 音声再生連動

---

### M6.4: 独自実装（必要な場合）

#### [P2][L] librosa導入・周波数解析実装

- [ ] Python環境構築
- [ ] librosa導入
- [ ] 周波数解析実装
- [ ] 音量解析実装
- [ ] 話速解析実装
- [ ] 沈黙解析実装
- [ ] フィラーワード検出
- 担当: バックエンドエンジニア（Python）
- 依存: なし

#### [P2][M] Cloud Functionデプロイ

- [ ] Cloud Function作成
- [ ] Python音声分析スクリプトデプロイ
- [ ] トリガー設定（GCSアップロード時）
- [ ] 感情スコア計算
- [ ] JSON保存
- 担当: DevOpsエンジニア、バックエンドエンジニア
- 依存: librosa導入・周波数解析実装

---

## フェーズ7: テスト・改善

### M7.1: 統合テスト

#### [P0][XL] E2Eテスト実装

- [ ] Playwright導入
- [ ] ログインフロー E2Eテスト
- [ ] 通話処理フロー E2Eテスト
- [ ] プロンプト管理 E2Eテスト
- [ ] トークスクリプト管理 E2Eテスト
- [ ] 学習資料管理 E2Eテスト
- [ ] ダッシュボード E2Eテスト
- 担当: フロントエンド・バックエンドエンジニア
- 依存: 全フェーズ完了

#### [P0][M] クロスブラウザテスト

- [ ] Chrome
- [ ] Firefox
- [ ] Safari
- [ ] Edge
- [ ] モバイルブラウザ（iOS Safari, Android Chrome）
- 担当: フロントエンドエンジニア
- 依存: E2Eテスト実装

#### [P0][M] モバイル対応確認

- [ ] レスポンシブデザイン確認
- [ ] タッチ操作確認
- [ ] パフォーマンス確認
- 担当: フロントエンドエンジニア
- 依存: クロスブラウザテスト

#### [P1][M] テストカバレッジレポート

- [ ] カバレッジ計測（Jest）
- [ ] カバレッジ目標達成確認（80%以上）
- [ ] カバレッジレポート生成
- 担当: フロントエンド・バックエンドエンジニア
- 依存: E2Eテスト実装

---

### M7.2: パフォーマンスチューニング

#### [P0][M] データベースクエリ最適化

- [ ] スロークエリ特定（EXPLAIN ANALYZE）
- [ ] インデックス追加
- [ ] クエリリファクタリング
- [ ] N+1問題解決
- 担当: データベースエンジニア、バックエンドエンジニア
- 依存: 統合テスト

#### [P0][M] Cloud Run設定調整

- [ ] CPU・メモリ設定最適化
- [ ] 同時実行数調整
- [ ] タイムアウト設定調整
- [ ] オートスケーリング設定
- 担当: DevOpsエンジニア
- 依存: 統合テスト

#### [P1][M] フロントエンドバンドルサイズ削減

- [ ] next-bundle-analyzer導入
- [ ] 大きな依存関係特定
- [ ] 動的インポート適用
- [ ] 不要な依存関係削除
- 担当: フロントエンドリード
- 依存: 統合テスト

#### [P1][M] 画像最適化

- [ ] next/image使用確認
- [ ] 画像圧縮
- [ ] WebP形式変換
- [ ] 遅延読み込み
- 担当: フロントエンドエンジニア
- 依存: フロントエンドバンドルサイズ削減

#### [P1][M] パフォーマンステストレポート

- [ ] Lighthouse実行
- [ ] Core Web Vitals確認
- [ ] パフォーマンススコア80以上達成
- 担当: フロントエンドリード
- 依存: 画像最適化

---

### M7.3: UI/UX改善

#### [P1][M] ユーザビリティテスト

- [ ] テストシナリオ作成
- [ ] 実際のユーザーでテスト実施
- [ ] フィードバック収集
- [ ] 改善リスト作成
- 担当: プロジェクトマネージャー、フロントエンドリード
- 依存: 統合テスト

#### [P0][L] アクセシビリティ対応

- [ ] axe DevToolsで監査
- [ ] WCAG 2.1 Level AA準拠確認
- [ ] キーボードナビゲーション確認
- [ ] スクリーンリーダー対応
- [ ] カラーコントラスト比確認（4.5:1以上）
- [ ] ARIA属性追加
- 担当: フロントエンドエンジニア
- 依存: ユーザビリティテスト

#### [P1][M] レスポンシブデザイン調整

- [ ] モバイル（640px）
- [ ] タブレット（768px）
- [ ] デスクトップ（1024px以上）
- [ ] ブレークポイント調整
- 担当: フロントエンドエンジニア
- 依存: アクセシビリティ対応

#### [P1][M] ローディング状態改善

- [ ] スケルトンローディング追加
- [ ] プログレスバー追加
- [ ] エラー状態改善
- [ ] 空状態改善
- 担当: フロントエンドエンジニア
- 依存: レスポンシブデザイン調整

---

### M7.4: 本番リリース準備

#### [P0][M] 本番環境構築

- [ ] 本番用GCPプロジェクト作成
- [ ] 本番用Supabaseプロジェクト作成
- [ ] 本番用環境変数設定
- [ ] 本番用GCSバケット作成
- [ ] 本番用Cloud Runデプロイ
- 担当: DevOpsエンジニア
- 依存: 全フェーズ完了

#### [P0][M] DNS・SSL設定

- [ ] ドメイン取得
- [ ] DNS設定（Vercel、Cloud Run）
- [ ] SSL証明書設定（Let's Encrypt）
- [ ] HTTPS強制リダイレクト
- 担当: DevOpsエンジニア
- 依存: 本番環境構築

#### [P0][M] 監視設定

- [ ] Sentry設定（エラー追跡）
- [ ] Google Cloud Monitoring設定
- [ ] アラート設定（エラーレート、レスポンスタイム等）
- [ ] Slack通知設定
- 担当: DevOpsエンジニア
- 依存: 本番環境構築

#### [P0][M] バックアップ設定

- [ ] Supabase自動バックアップ確認（日次）
- [ ] GCSバックアップ設定
- [ ] 災害復旧計画作成
- 担当: DevOpsエンジニア
- 依存: 本番環境構築

#### [P0][L] ドキュメント整備

- [ ] 運用マニュアル作成
- [ ] トラブルシューティングガイド作成
- [ ] API仕様書最終更新
- [ ] ユーザーマニュアル作成
- 担当: プロジェクトマネージャー
- 依存: 本番環境構築

#### [P0][M] 本番デプロイ

- [ ] デプロイチェックリスト確認
- [ ] 本番環境デプロイ実行
- [ ] スモークテスト実施
- [ ] 監視確認
- [ ] リリースアナウンス
- 担当: DevOpsエンジニア、プロジェクトマネージャー
- 依存: 全タスク完了

---

**以上**
