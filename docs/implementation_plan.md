# 実装計画書

**バージョン**: 1.0.0
**作成日**: 2025-01-15
**総開発期間**: 7-10ヶ月
**対象システム**: Zoom Phone フィードバックシステム 拡張版

---

## 目次

1. [実装方針](#実装方針)
2. [フェーズ概要](#フェーズ概要)
3. [フェーズ1: 基盤構築](#フェーズ1-基盤構築)
4. [フェーズ2: プロンプト管理](#フェーズ2-プロンプト管理)
5. [フェーズ3: トークスクリプト管理](#フェーズ3-トークスクリプト管理)
6. [フェーズ4: 学習資料・RAG](#フェーズ4-学習資料rag)
7. [フェーズ5: KPI・ダッシュボード](#フェーズ5-kpiダッシュボード)
8. [フェーズ6: 音声感情分析](#フェーズ6-音声感情分析)
9. [フェーズ7: テスト・改善](#フェーズ7-テスト改善)
10. [リスク管理](#リスク管理)

---

## 実装方針

### アジャイル開発

- **スプリント期間**: 2週間
- **リリース戦略**: 段階的リリース（フェーズごと）
- **品質保証**: 各フェーズ終了時に品質チェック

### 技術方針

1. **TypeScript First**: 全コードをTypeScriptで記述
2. **テスト駆動開発**: ユニットテスト → 統合テスト → E2Eテスト
3. **CI/CD**: GitHub Actionsで自動デプロイ
4. **コードレビュー**: 全PRに対してレビュー必須
5. **ドキュメント**: コード内コメント + API仕様書の同期更新

### チーム構成（推奨）

| ロール | 人数 | 責任範囲 |
|--------|------|---------|
| **フロントエンドエンジニア** | 2名 | Next.js、UI/UX実装 |
| **バックエンドエンジニア** | 2名 | Cloud Run、API、AI統合 |
| **データベースエンジニア** | 1名 | Supabase、pgvector、RLS |
| **DevOpsエンジニア** | 1名 | GCP、CI/CD、監視 |
| **プロジェクトマネージャー** | 1名 | 進捗管理、要件調整 |

---

## フェーズ概要

```
┌─────────────────────────────────────────────────────────────┐
│ フェーズ1: 基盤構築（1-2ヶ月）                                │
│ ✓ インフラ構築、認証、基本的な通話処理                         │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ フェーズ2: プロンプト管理（1ヶ月）                             │
│ ✓ プロンプトUI、履歴、AIアシスタント                           │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ フェーズ3: トークスクリプト管理（1ヶ月）                        │
│ ✓ トークスクリプトUI、一致率分析、因果関係ロジック              │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ フェーズ4: 学習資料・RAG（1-2ヶ月）                            │
│ ✓ 学習資料アップロード、Embedding、RAG実装                     │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ フェーズ5: KPI・ダッシュボード（1ヶ月）                         │
│ ✓ KPI集計、グラフ、NG理由分析                                 │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ フェーズ6: 音声感情分析（1-2ヶ月）                             │
│ ✓ 周波数解析、感情グラフ                                      │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│ フェーズ7: テスト・改善（1ヶ月）                               │
│ ✓ 統合テスト、パフォーマンスチューニング、本番リリース          │
└─────────────────────────────────────────────────────────────┘
```

---

## フェーズ1: 基盤構築

**期間**: 1-2ヶ月
**ゴール**: システムの基盤を構築し、基本的な通話処理フローを完成させる

### マイルストーン

#### M1.1: 開発環境構築（1週間）

- [x] Next.js 14プロジェクト初期化
- [x] TypeScript + ESLint + Prettier設定
- [ ] Supabaseプロジェクト作成
- [ ] GCPプロジェクト作成
- [ ] GitHub Repositoryセットアップ
- [ ] CI/CD基本設定（GitHub Actions）

**成果物**:
- [x] `package.json` 完成
- [x] `.env.example` 完成
- [x] `README.md` セットアップ手順記載

---

#### M1.2: データベース構築（1週間）

- [x] Supabase拡張機能有効化（uuid-ossp, pgvector, pg_cron）
- [x] 全11テーブル作成
- [x] インデックス作成
- [x] RLSポリシー設定
- [x] トリガー実装（updated_at自動更新等）
- [x] マイグレーションスクリプト作成

**成果物**:
- [x] `supabase/migrations/` 配下のSQLファイル
- [x] データベース設計書との整合性確認

---

#### M1.3: 認証機能実装（1週間）

- [ ] Supabase Auth設定
- [ ] Google OAuth設定
- [ ] Email/Passwordログイン実装
- [ ] Next.js Middlewareで認証チェック
- [ ] ログインページ実装
- [ ] ユーザー情報取得API実装

**成果物**:
- `/app/login/page.tsx`
- `/app/api/auth/*` API Routes
- `middleware.ts`

---

#### M1.4: GCS・Cloud Run構築（1週間）

- [ ] GCSバケット作成
- [ ] Lifecycle設定（6ヶ月自動削除）
- [ ] Cloud Run: Zoom Proxy Service デプロイ
- [ ] Cloud Run: Backend Processor Service デプロイ
- [ ] Cloud Pub/Sub設定
- [ ] 環境変数管理（Secret Manager）

**成果物**:
- `backend/zoom-proxy/` 初期実装
- `backend/processor/` 初期実装
- `Dockerfile` × 2
- GCS Lifecycle設定ファイル

---

#### M1.5: 基本的な通話処理フロー（2週間）

- [ ] Zoom Webhook受信実装
- [ ] 音声ダウンロード実装
- [ ] GCS保存実装
- [ ] Whisper API連携（文字起こし）
- [ ] GPT-5-mini連携（通話状態判定）
- [ ] Supabaseへのメタデータ保存
- [ ] Slack通知実装（基本版）

**成果物**:
- `/webhook/zoom` エンドポイント
- Backend Processor 完成
- `calls` テーブルへのデータ保存確認

---

#### M1.6: プロジェクト・ユーザー管理（1週間）

- [ ] プロジェクト一覧ページ
- [ ] プロジェクト作成・編集・削除
- [ ] メンバー管理UI
- [ ] ロール管理（オーナー/ディレクター/ユーザー）
- [ ] RLSによるアクセス制御確認

**成果物**:
- `/app/projects/*` ページ
- `/app/api/projects/*` API Routes

---

### フェーズ1完了条件

- [ ] ユーザーがログインできる
- [ ] Zoom Webhookを受信し、通話データが保存される
- [ ] 文字起こしが完了し、GCSに保存される
- [ ] 通話状態判定（connected/reception/no_conversation）が動作する
- [ ] プロジェクト・メンバー管理ができる
- [ ] 全ユニットテストがパス（カバレッジ80%以上）

---

## フェーズ2: プロンプト管理

**期間**: 1ヶ月
**ゴール**: プロンプト管理機能を完成させ、フィードバック生成を実装する

### マイルストーン

#### M2.1: プロンプト管理UI（1週間）

- [ ] プロンプト一覧ページ
- [ ] プロンプト作成・編集フォーム
- [ ] マークダウンエディタ統合
- [ ] 文字数カウンター表示
- [ ] プロンプトタイプ切り替え（connected/reception）

**成果物**:
- `/app/projects/[id]/prompts/page.tsx`
- `/app/api/prompts/*` API Routes

---

#### M2.2: プロンプトバージョン管理（1週間）

- [ ] 変更履歴表示（過去10件）
- [ ] バージョン復元機能
- [ ] 変更コメント記録
- [ ] `is_active` フラグ管理
- [ ] トリガーによる自動バージョン管理

**成果物**:
- 履歴表示UI
- バージョン復元機能

---

#### M2.3: AIプロンプトアシスタント（1週間）

- [ ] 音声録音UI（Web Audio API）
- [ ] Whisper API連携（音声→文字起こし）
- [ ] GPT-5連携（文字起こし→プロンプト生成）
- [ ] 生成されたプロンプトの編集UI
- [ ] プロンプト保存

**成果物**:
- `/app/api/prompts/generate` エンドポイント
- 音声録音コンポーネント

---

#### M2.4: フィードバック生成実装（1週間）

- [ ] GPT-5-mini連携（基本フィードバック生成）
- [ ] プロンプト取得ロジック（プロジェクト固有 or デフォルト）
- [ ] フィードバック生成条件判定
- [ ] Slack通知にフィードバック追加
- [ ] 通話詳細ページにフィードバック表示

**成果物**:
- Backend Processor: フィードバック生成ロジック
- `/app/calls/[id]/page.tsx` フィードバック表示

---

### フェーズ2完了条件

- [ ] プロンプトの作成・編集・履歴管理ができる
- [ ] AIプロンプトアシスタントが動作する
- [ ] 通話に対してフィードバックが生成される
- [ ] Slackにフィードバックが通知される
- [ ] 統合テストがパス

---

## フェーズ3: トークスクリプト管理

**期間**: 1ヶ月
**ゴール**: トークスクリプト機能を完成させ、因果関係を考慮したフィードバックを実装する

### マイルストーン

#### M3.1: トークスクリプト管理UI（1週間）

- [ ] トークスクリプト作成・編集ページ
- [ ] フェーズ別入力フォーム（オープニング/ヒアリング/提案/クロージング）
- [ ] ヒアリング項目管理UI
- [ ] デフォルト項目「現在の課題」の削除不可制約
- [ ] 表示順序のドラッグ&ドロップ

**成果物**:
- `/app/projects/[id]/talk-scripts/page.tsx`
- `/app/api/talk-scripts/*` API Routes

---

#### M3.2: PDF取り込み機能（1週間）

- [ ] PDFアップロードUI
- [ ] GPT-5 Vision API連携（PDF→テキスト抽出）
- [ ] フェーズ自動判定ロジック
- [ ] ヒアリング項目自動抽出
- [ ] 抽出結果の編集UI
- [ ] OCRフォールバック（Tesseract等）

**成果物**:
- `/app/api/talk-scripts/import-pdf` エンドポイント
- GPT-5によるフェーズ判定プロンプト

---

#### M3.3: トークスクリプト一致率分析（1週間）

- [ ] GPT-5連携（セマンティック一致率評価）
- [ ] フェーズ別一致率計算
- [ ] ヒアリング項目カバー率計算
- [ ] JSONB形式でのデータ保存
- [ ] 分析結果の通話詳細ページ表示

**成果物**:
- Backend Processor: トークスクリプト分析ロジック
- GPT-5プロンプト設計
- 通話詳細ページに一致率表示

---

#### M3.4: 因果関係を考慮したフィードバック統合（1週間）

- [ ] 因果関係判定ロジック実装
- [ ] パターンA: ヒアリング不足判定
- [ ] パターンB: 提案力不足判定
- [ ] パターンC: クロージング不足判定
- [ ] トークスクリプト分析結果をフィードバックに統合
- [ ] GPT-5へのシステムプロンプト更新

**成果物**:
- 因果関係ロジック実装
- 統合フィードバック生成

---

### フェーズ3完了条件

- [ ] トークスクリプトの作成・編集ができる
- [ ] PDFから自動的にフェーズ判定できる
- [ ] トークスクリプト一致率が計算される
- [ ] 因果関係を考慮したフィードバックが生成される
- [ ] 通話詳細ページに分析結果が表示される
- [ ] 統合テストがパス

---

## フェーズ4: 学習資料・RAG

**期間**: 1-2ヶ月
**ゴール**: 学習資料管理とRAG検索を実装し、フィードバック品質を向上させる

### マイルストーン

#### M4.1: 学習資料管理UI（1週間）

- [ ] 学習資料一覧ページ
- [ ] アップロードUI（詳細資料2個、事例集5個）
- [ ] ファイルタイプ検証（PDF/CSV、最大10MB）
- [ ] プレビュー機能（PDF: iframe、CSV: テーブル）
- [ ] 削除機能

**成果物**:
- `/app/projects/[id]/learning-materials/page.tsx`
- `/app/api/learning-materials/*` API Routes

---

#### M4.2: Embedding処理実装（1週間）

- [ ] PDFパース処理（pdf-parse等）
- [ ] CSVパース処理
- [ ] テキストチャンキング（500文字程度）
- [ ] OpenAI Embedding API連携
- [ ] `learning_material_embeddings` テーブル保存
- [ ] バッチ処理（大量データ対応）

**成果物**:
- Backend Processor: Embedding処理
- チャンキングロジック

---

#### M4.3: pgvector設定・RAG検索実装（1週間）

- [ ] pgvector拡張機能確認
- [ ] ベクトル検索インデックス作成
- [ ] RAG検索関数実装（上位5件取得）
- [ ] 検索結果のフィルタリング（プロジェクトID）
- [ ] 検索パフォーマンスチューニング

**成果物**:
- RAG検索関数（Supabase Function or Backend）
- ベクトル検索クエリ

---

#### M4.4: RAG統合フィードバック生成（1週間）

- [ ] RAG検索結果をフィードバック生成に統合
- [ ] GPT-5プロンプトに検索結果を埋め込み
- [ ] RAGあり: GPT-5、RAGなし: GPT-5-mini の切り替え
- [ ] 事例集の業種別・課題別検索
- [ ] フィードバック品質確認

**成果物**:
- RAG統合フィードバック生成ロジック
- GPT-5プロンプト更新

---

### フェーズ4完了条件

- [ ] 学習資料のアップロード・削除ができる
- [ ] Embedding処理が正常に動作する
- [ ] RAG検索が正確に動作する
- [ ] RAG検索結果を活用したフィードバックが生成される
- [ ] フィードバック品質が向上している
- [ ] 統合テストがパス

---

## フェーズ5: KPI・ダッシュボード

**期間**: 1ヶ月
**ゴール**: KPI集計とダッシュボードを実装し、リアルタイムデータ可視化を実現する

### マイルストーン

#### M5.1: KPI集計API実装（1週間）

- [ ] KPI集計クエリ実装（架電数、接続数、接続率等）
- [ ] 期間別集計（日次/週次/月次/カスタム）
- [ ] プロジェクト別・ユーザー別集計
- [ ] アポイント数・有効リード数集計
- [ ] API実装（`/api/kpi`）

**成果物**:
- `/app/api/kpi/*` API Routes
- KPI集計クエリ

---

#### M5.2: ダッシュボードUI実装（1週間）

- [ ] ダッシュボードページ作成
- [ ] KPIカード表示（架電数、接続数等）
- [ ] 折れ線グラフ（接続率推移）
- [ ] 棒グラフ（ユーザー別架電数）
- [ ] 円グラフ（通話状態比率）
- [ ] Recharts統合

**成果物**:
- `/app/dashboard/page.tsx`
- グラフコンポーネント

---

#### M5.3: NG理由分析機能（1週間）

- [ ] GPT-5-mini連携（NG理由判定）
- [ ] 既存分類への自動分類
- [ ] `ng_reason_logs` テーブル保存
- [ ] NG理由集計API（`/api/kpi/ng-reasons`）
- [ ] NG理由グラフ表示（円グラフ、棒グラフ）
- [ ] 時系列グラフ（トレンド分析）

**成果物**:
- Backend Processor: NG理由判定ロジック
- NG理由分析UI

---

#### M5.4: リアルタイム更新実装（1週間）

- [ ] Supabase Realtime Subscription設定
- [ ] 通話処理完了時にリアルタイム更新
- [ ] ダッシュボードの自動更新
- [ ] トースト通知（新しい通話データ）

**成果物**:
- Realtime Subscription実装
- リアルタイム更新ロジック

---

### フェーズ5完了条件

- [ ] KPIが正確に集計される
- [ ] ダッシュボードにグラフが表示される
- [ ] NG理由分析が動作する
- [ ] リアルタイム更新が動作する
- [ ] 統合テストがパス

---

## フェーズ6: 音声感情分析

**期間**: 1-2ヶ月
**ゴール**: 音声周波数解析による感情分析を実装する

### マイルストーン

#### M6.1: 既存API調査（1週間）

- [ ] Google Cloud Speech-to-Text 感情分析調査
- [ ] Azure Emotion API調査
- [ ] AWS Transcribe 感情分析調査
- [ ] コスト・精度比較
- [ ] 採用API決定

**成果物**:
- API比較レポート
- 採用API選定

---

#### M6.2: 音声感情分析実装（2週間）

- [ ] 選定APIとの連携実装
- [ ] 音声ファイルのアップロード
- [ ] 感情スコア取得
- [ ] 営業担当者/顧客の分離
- [ ] JSONデータ生成
- [ ] GCS保存

**成果物**:
- Backend Processor: 感情分析ロジック
- 感情分析データ（JSON）

---

#### M6.3: 感情分析グラフUI（1週間）

- [ ] グラフコンポーネント作成
- [ ] 時間軸表示
- [ ] 周波数軸表示
- [ ] カラーマップ（緑/黄/赤）
- [ ] グラフ上クリックで音声再生
- [ ] 文字起こしハイライト連動

**成果物**:
- 感情分析グラフコンポーネント
- 通話詳細ページ統合

---

#### M6.4: 独自実装（必要な場合）（2週間）

- [ ] librosa導入（Python）
- [ ] 周波数解析実装
- [ ] 音量解析実装
- [ ] 話速解析実装
- [ ] 沈黙解析実装
- [ ] フィラーワード検出

**成果物**:
- Python音声分析スクリプト
- Cloud Functionデプロイ

---

### フェーズ6完了条件

- [ ] 音声感情分析が動作する
- [ ] 感情分析グラフが表示される
- [ ] グラフ上クリックで音声再生できる
- [ ] 文字起こしと連動する
- [ ] 統合テストがパス

---

## フェーズ7: テスト・改善

**期間**: 1ヶ月
**ゴール**: 全体的な品質向上と本番リリース準備

### マイルストーン

#### M7.1: 統合テスト（1週間）

- [ ] E2Eテスト実装（Playwright）
- [ ] 通話処理フロー全体のテスト
- [ ] ユーザーシナリオテスト
- [ ] クロスブラウザテスト
- [ ] モバイル対応確認

**成果物**:
- `e2e/` テストスイート
- テストカバレッジレポート

---

#### M7.2: パフォーマンスチューニング（1週間）

- [ ] データベースクエリ最適化
- [ ] インデックス追加
- [ ] Cloud Run設定調整
- [ ] GCS署名URL有効期限調整
- [ ] フロントエンドバンドルサイズ削減
- [ ] 画像最適化

**成果物**:
- パフォーマンステストレポート
- 最適化実装

---

#### M7.3: UI/UX改善（1週間）

- [ ] ユーザビリティテスト
- [ ] アクセシビリティ対応（WCAG 2.1 Level AA）
- [ ] レスポンシブデザイン調整
- [ ] ローディング状態の改善
- [ ] エラーメッセージの改善

**成果物**:
- UI/UX改善リスト
- アクセシビリティ監査レポート

---

#### M7.4: 本番リリース準備（1週間）

- [ ] 本番環境構築
- [ ] 環境変数設定
- [ ] DNS設定
- [ ] SSL証明書設定
- [ ] 監視設定（Sentry、Cloud Monitoring）
- [ ] バックアップ設定
- [ ] ドキュメント整備
- [ ] 本番デプロイ

**成果物**:
- 本番環境
- 運用ドキュメント
- リリースノート

---

### フェーズ7完了条件

- [ ] 全テストがパス（ユニット、統合、E2E）
- [ ] パフォーマンス要件を満たす
- [ ] アクセシビリティ基準を満たす
- [ ] 本番環境にデプロイ完了
- [ ] 監視・バックアップ設定完了
- [ ] ドキュメント完備

---

## リスク管理

### 技術的リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| **OpenAI APIレート制限** | 高 | バッチ処理、リトライロジック、レート制限監視 |
| **GPT-5の仕様変更** | 中 | GPT-5-miniへのフォールバック実装 |
| **pgvectorのスケーラビリティ** | 中 | インデックスチューニング、パーティショニング |
| **Cloud Run実行時間制限** | 中 | 非同期処理、タイムアウト管理 |
| **GCS Signed URL期限切れ** | 低 | 動的再生成、キャッシュ管理 |

### スケジュールリスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| **要件追加** | 高 | スコープ管理、優先順位付け |
| **技術的難易度の見積もりミス** | 中 | バッファ期間確保、早期プロトタイピング |
| **リソース不足** | 中 | 外部リソース確保、タスク優先順位調整 |

### 運用リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| **コスト超過** | 中 | コスト監視、使用量アラート設定 |
| **データ損失** | 高 | 定期バックアップ、災害復旧計画 |
| **セキュリティインシデント** | 高 | セキュリティ監査、ペネトレーションテスト |

---

## 成功指標（KPI）

### 開発プロセス

- [ ] 各フェーズのスケジュール遵守率: 90%以上
- [ ] コードレビュー完了率: 100%
- [ ] テストカバレッジ: 80%以上
- [ ] バグ修正率: 95%以上（リリース前）

### システム品質

- [ ] レスポンスタイム: p95 < 500ms
- [ ] エラーレート: < 1%
- [ ] 稼働率: 99.9%以上
- [ ] セキュリティ脆弱性: クリティカル 0件

### ユーザー満足度

- [ ] ユーザー満足度調査: 4.0/5.0以上
- [ ] システム利用率: 80%以上
- [ ] フィードバック品質評価: 4.0/5.0以上

---

**以上**
